<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Your Vehicle for Rental | PreRental</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #f72585;
            --border-radius: 8px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        .navbar {
            background-color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .back-btn:hover {
            color: var(--secondary);
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: var(--border-radius);
        }

        .page-header h1 {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: var(--border-radius);
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            transition: var(--transition);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.15);
        }

        .dropzone {
            border: 2px dashed #dee2e6;
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: #f8f9fa;
        }

        .dropzone:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 1rem;
        }

        .image-preview {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            border: 1px solid #e0e0e0;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-image:hover {
            background: var(--danger);
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            padding: 10px 20px;
            font-weight: 500;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .btn-primary:hover {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }

        .btn-secondary {
            border-radius: var(--border-radius);
            padding: 10px 20px;
            font-weight: 500;
        }

        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .feature-checkbox {
            margin-bottom: 0.75rem;
        }

        .feature-checkbox .form-check-label {
            display: flex;
            align-items: center;
        }

        .feature-checkbox i {
            margin-right: 8px;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .page-header {
                padding: 2rem 1rem;
            }

            .dropzone {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg mb-4">
        <div class="container-fluid">
            <a class="navbar-brand logo" href="#">PreRental</a>
            <button class="back-btn" onclick="window.location.href='memberPage.html'">
                <i class="bi bi-arrow-left me-1"></i> Back to Dashboard
            </button>
        </div>
    </nav>

    <header class="page-header text-center">
        <h1><i class="bi bi-car-front me-2"></i>Post Your Vehicle</h1>
        <p class="lead mb-0">List your vehicle and start earning today</p>
    </header>

    <form id="vehiclePostForm">
        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-images"></i> Vehicle Images</h5>
                <div class="dropzone" id="imageDropzone" onclick="document.getElementById('vehicleImages').click()">
                    <i class="bi bi-cloud-arrow-up fs-1" style="color: var(--primary);"></i>
                    <p class="mt-3 mb-1 fw-medium">Click to upload or drag and drop</p>
                    <small class="text-muted">Upload 3-10 photos (JPG/PNG, max 5MB each)</small>
                </div>
                <input type="file" id="vehicleImages" class="d-none" multiple accept="image/*" onchange="handleImageUpload(this)">
                <div class="image-preview-container" id="imagePreviewContainer"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-info-circle"></i> Basic Information</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="vehicleType" class="form-label">Vehicle Type</label>
                        <select class="form-select" id="vehicleType" required>
                            <option value="" selected disabled>Select type</option>
                            <option value="sedan">Sedan</option>
                            <option value="suv">SUV</option>
                            <option value="hatchback">Hatchback</option>
                            <option value="coupe">Coupe</option>
                            <option value="convertible">Convertible</option>
                            <option value="pickup">Pickup Truck</option>
                            <option value="van">Van/Minivan</option>
                            <option value="luxury">Luxury</option>
                            <option value="electric">Electric</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="brand" class="form-label">Brand</label>
                        <input type="text" class="form-control" id="brand" placeholder="e.g. Toyota" required>
                    </div>
                    <div class="col-md-6">
                        <label for="model" class="form-label">Model</label>
                        <input type="text" class="form-control" id="model" placeholder="e.g. Camry" required>
                    </div>
                    <div class="col-md-6">
                        <label for="year" class="form-label">Year</label>
                        <input type="number" class="form-control" id="year" min="1990" max="2025" placeholder="e.g. 2022" required>
                    </div>
                    <div class="col-md-6">
                        <label for="plateNumber" class="form-label">License Plate</label>
                        <input type="text" class="form-control" id="plateNumber" placeholder="e.g. ABC 1234" required>
                    </div>
                    <div class="col-md-6">
                        <label for="color" class="form-label">Color</label>
                        <input type="text" class="form-control" id="color" placeholder="e.g. Silver" required>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-gear"></i> Technical Specifications</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="fuelType" class="form-label">Fuel Type</label>
                        <select class="form-select" id="fuelType" required>
                            <option value="" selected disabled>Select fuel type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="electric">Electric</option>
                            <option value="cng">CNG</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="engineCapacity" class="form-label">Engine Capacity (cc)</label>
                        <input type="number" class="form-control" id="engineCapacity" placeholder="e.g. 2000">
                    </div>
                    <div class="col-md-6">
                        <label for="transmission" class="form-label">Transmission</label>
                        <select class="form-select" id="transmission" required>
                            <option value="" selected disabled>Select transmission</option>
                            <option value="automatic">Automatic</option>
                            <option value="manual">Manual</option>
                            <option value="semi-automatic">Semi-Automatic</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="seatingCapacity" class="form-label">Seating Capacity</label>
                        <input type="number" class="form-control" id="seatingCapacity" min="1" max="20" placeholder="e.g. 5" required>
                    </div>
                    <div class="col-md-6">
                        <label for="mileage" class="form-label">Mileage (km)</label>
                        <input type="number" class="form-control" id="mileage" placeholder="e.g. 25000">
                    </div>
                    <div class="col-md-6">
                        <label for="fuelEfficiency" class="form-label">Fuel Efficiency (km/l)</label>
                        <input type="number" class="form-control" id="fuelEfficiency" step="0.1" placeholder="e.g. 15.5">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-cash-coin"></i> Rental Information</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="dailyRate" class="form-label">Daily Rate ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="dailyRate" min="1" step="0.01" placeholder="49.99" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="weeklyRate" class="form-label">Weekly Rate ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="weeklyRate" min="1" step="0.01" placeholder="299.99">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="monthlyRate" class="form-label">Monthly Rate ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="monthlyRate" min="1" step="0.01" placeholder="999.99">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="minRentalDays" class="form-label">Minimum Rental Days</label>
                        <input type="number" class="form-control" id="minRentalDays" min="1" value="1" required>
                    </div>
                    <div class="col-md-6">
                        <label for="depositAmount" class="form-label">Key Money Deposit ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="depositAmount" min="0" step="0.01" placeholder="200.00">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="availableNow">
                            <label class="form-check-label" for="availableNow">Available for immediate rental</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-list-check"></i> Features & Amenities</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="ac">
                            <label class="form-check-label" for="ac"><i class="bi bi-snow"></i> Air Conditioning</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="bluetooth">
                            <label class="form-check-label" for="bluetooth"><i class="bi bi-bluetooth"></i> Bluetooth</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="navigation">
                            <label class="form-check-label" for="navigation"><i class="bi bi-signpost"></i> Navigation</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="sunroof">
                            <label class="form-check-label" for="sunroof"><i class="bi bi-sun"></i> Sunroof</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="cruiseControl">
                            <label class="form-check-label" for="cruiseControl"><i class="bi bi-speedometer2"></i> Cruise Control</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="backupCamera">
                            <label class="form-check-label" for="backupCamera"><i class="bi bi-camera-video"></i> Backup Camera</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="heatedSeats">
                            <label class="form-check-label" for="heatedSeats"><i class="bi bi-thermometer-sun"></i> Heated Seats</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="childSeat">
                            <label class="form-check-label" for="childSeat"><i class="bi bi-emoji-child"></i> Child Seat</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="tollPass">
                            <label class="form-check-label" for="tollPass"><i class="bi bi-pass"></i> Toll Pass</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="gpsTracker">
                            <label class="form-check-label" for="gpsTracker"><i class="bi bi-pin-map"></i> GPS Tracker</label>
                        </div>
                        <div class="form-check feature-checkbox">
                            <input class="form-check-input" type="checkbox" id="wifiHotspot">
                            <label class="form-check-label" for="wifiHotspot"><i class="bi bi-wifi"></i> WiFi Hotspot</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-card-text"></i> Additional Information</h5>
                <div class="mb-3">
                    <label for="description" class="form-label">Vehicle Description</label>
                    <textarea class="form-control" id="description" rows="4" placeholder="Describe your vehicle..." required></textarea>
                </div>
                <div class="mb-3">
                    <label for="rentalTerms" class="form-label">Rental Terms</label>
                    <textarea class="form-control" id="rentalTerms" rows="3" placeholder="Any specific terms for renters"></textarea>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                    <label class="form-check-label" for="agreeTerms">I certify that all information is accurate and agree to the Terms of Service</label>
                </div>
            </div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
            <button type="reset" class="btn btn-secondary me-md-2 px-4">
                <i class="bi bi-x-circle me-1"></i> Reset
            </button>
            <button type="button" class="btn btn-primary px-4" onclick="saveVehicle()">
                <i class="bi bi-check-circle me-1"></i> Submit Listing
            </button>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

<script>
    function saveVehicle() {
        const token = localStorage.getItem('token');
        const decodedToken = jwt_decode(token);
        const userEmail = decodedToken.email;

        const formData = new FormData();
        const image = $('#vehicleImages')[0].files[0];
        if (image) {
            formData.append('file', image);
        }

        const vehicleDTO = {
            vehicleType: $('#vehicleType').val(),
            brand: $('#brand').val(),
            model: $('#model').val(),
            year: parseInt($('#year').val()),
            plateNumber: $('#plateNumber').val(),
            color: $('#color').val(),
            fuelType: $('#fuelType').val(),
            engineCapacity: $('#engineCapacity').val() ? parseInt($('#engineCapacity').val()) : null,
            transmission: $('#transmission').val(),
            seatingCapacity: parseInt($('#seatingCapacity').val()),
            mileage: $('#mileage').val() ? parseInt($('#mileage').val()) : null,
            fuelEfficiency: $('#fuelEfficiency').val() ? parseFloat($('#fuelEfficiency').val()) : null,
            dailyRate: parseFloat($('#dailyRate').val()),
            weeklyRate: $('#weeklyRate').val() ? parseFloat($('#weeklyRate').val()) : null,
            monthlyRate: $('#monthlyRate').val() ? parseFloat($('#monthlyRate').val()) : null,
            minRentalDays: parseInt($('#minRentalDays').val()),
            depositAmount: $('#depositAmount').val() ? parseFloat($('#depositAmount').val()) : null,
            availableNow: $('#availableNow').is(':checked'),
            airCondition: $('#ac').is(':checked'),
            bluetooth: $('#bluetooth').is(':checked'),
            Navigation: $('#navigation').is(':checked'),
            sunroof: $('#sunroof').is(':checked'),
            cruiseControl: $('#cruiseControl').is(':checked'),
            backCamera: $('#backupCamera').is(':checked'),
            heatedSeat: $('#heatedSeats').is(':checked'),
            childSeat: $('#childSeat').is(':checked'),
            tollPass: $('#tollPass').is(':checked'),
            gpsTracker: $('#gpsTracker').is(':checked'),
            wifiHotspot: $('#wifiHotspot').is(':checked'),
            description: $('#description').val(),
            rentalTerms: $('#rentalTerms').val(),
            owner: { email: userEmail }
        };

        formData.append('vehicleDTO', new Blob([JSON.stringify(vehicleDTO)], { type: 'application/json' }));

        $.ajax({
            url: 'http://localhost:8080/api/v1/vehicle/saveVehicle',
            method: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: { Authorization: 'Bearer ' + token },
            success: function(response) {
                Swal.fire({
                    icon: 'success',
                    title: 'Vehicle saved successfully!',
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    window.location.href = 'postAddVehicle.html';
                });
            },
            error: function(xhr, status, error) {
                let errorMsg = error;
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMsg = xhr.responseJSON.message;
                }
                Swal.fire({
                    icon: 'error',
                    title: 'Error saving vehicle',
                    text: errorMsg
                });
            }
        });
    }

    function handleImageUpload(input) {
        const previewContainer = document.getElementById('imagePreviewContainer');
        previewContainer.innerHTML = '';

        if (input.files && input.files.length > 0) {
            for (let i = 0; i < input.files.length; i++) {
                const file = input.files[i];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const previewDiv = document.createElement('div');
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';

                    const removeBtn = document.createElement('span');
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '&times;';
                    removeBtn.onclick = function() {
                        previewDiv.remove();
                    };

                    img.appendChild(removeBtn);
                    previewDiv.appendChild(img);
                    previewContainer.appendChild(previewDiv);
                }

                reader.readAsDataURL(file);
            }
        }
    }
</script>
</body>
</html>