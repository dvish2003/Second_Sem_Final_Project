<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Your Vehicle for Rental</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ddd;
            position: relative;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        .dropzone {
            border: 2px dashed #dee2e6;
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dropzone:hover {
            border-color: #0d6efd;
            background-color: #f8f9fa;
        }

        .section-title {
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 5px;
            margin-bottom: 20px;
        }

        .page-header {
            background-color: #0d6efd;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0.3rem;
        }

        .navbar {
            background-color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }

        .navbar .logo span {
            color: #000;
        }

        .navbar .back-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar .back-btn span {
            font-size: 1.2rem;
        }

        .navbar .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .navbar .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .navbar .user-info p {
            margin: 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="navbar">
        <div class="logo">Pre<span>Rental</span></div>
        <button class="back-btn" onclick="window.location.href='memberPage.html'">
            <span class="material-icons-sharp">arrow_back</span> Back to Dashboard
        </button>
    </div>

    <br>
    <header class="page-header text-center">
        <h1><i class="bi bi-car-front"></i> Post Your Vehicle for Rental</h1>
        <p class="lead">Fill out the form below to list your vehicle for rent</p>
    </header>

    <!-- Main Form -->
    <form id="vehiclePostForm" class="mb-5">
        <!-- Vehicle Images Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-images"></i> Vehicle Images</h5>
                <div class="dropzone" id="imageDropzone" onclick="document.getElementById('vehicleImages').click()">
                    <i class="bi bi-cloud-arrow-up fs-1 text-primary"></i>
                    <p class="mt-2 mb-1">Click to upload vehicle images or drag and drop</p>
                    <small class="text-muted">(Minimum 3 photos, maximum 10. JPG/PNG, max 5MB each)</small>
                </div>
                <input type="file" id="vehicleImages" name="vehicleImages" class="d-none" multiple accept="image/*"
                       onchange="handleImageUpload(this)">
                <div class="image-preview-container" id="imagePreviewContainer"></div>
            </div>
        </div>

        <!-- Basic Information Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-info-circle"></i> Basic Information</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="vehicleType" class="form-label">Vehicle Type <span
                                class="text-danger">*</span></label>
                        <select class="form-select" id="vehicleType" name="vehicleType" required>
                            <option value="" selected disabled>Select vehicle type</option>
                            <option value="sedan">Sedan</option>
                            <option value="suv">SUV</option>
                            <option value="hatchback">Hatchback</option>
                            <option value="coupe">Coupe</option>
                            <option value="convertible">Convertible</option>
                            <option value="pickup">Pickup Truck</option>
                            <option value="van">Van/Minivan</option>
                            <option value="luxury">Luxury Vehicle</option>
                            <option value="electric">Electric Vehicle</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="brand" class="form-label">Brand <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="brand" name="brand" placeholder="e.g. Toyota"
                               required>
                    </div>
                    <div class="col-md-6">
                        <label for="model" class="form-label">Model <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="model" name="model" placeholder="e.g. Camry"
                               required>
                    </div>
                    <div class="col-md-6">
                        <label for="year" class="form-label">Year <span class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="year" name="year" min="1990" max="2025"
                               placeholder="e.g. 2022" required>
                    </div>
                    <div class="col-md-6">
                        <label for="plateNumber" class="form-label">License Plate Number <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="plateNumber" name="plateNumber"
                               placeholder="e.g. ABC 1234" required>
                    </div>
                    <div class="col-md-6">
                        <label for="color" class="form-label">Color <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="color" name="color" placeholder="e.g. Silver"
                               required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Specifications Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-gear"></i> Technical Specifications</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="fuelType" class="form-label">Fuel Type <span class="text-danger">*</span></label>
                        <select class="form-select" id="fuelType" name="fuelType" required>
                            <option value="" selected disabled>Select fuel type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="electric">Electric</option>
                            <option value="cng">CNG</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="engineCapacity" class="form-label">Engine Capacity (cc)</label>
                        <input type="number" class="form-control" id="engineCapacity" name="engineCapacity"
                               placeholder="e.g. 2000">
                    </div>
                    <div class="col-md-6">
                        <label for="transmission" class="form-label">Transmission <span
                                class="text-danger">*</span></label>
                        <select class="form-select" id="transmission" name="transmission" required>
                            <option value="" selected disabled>Select transmission</option>
                            <option value="automatic">Automatic</option>
                            <option value="manual">Manual</option>
                            <option value="semi-automatic">Semi-Automatic</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="seatingCapacity" class="form-label">Seating Capacity <span
                                class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="seatingCapacity" name="seatingCapacity" min="1"
                               max="20" placeholder="e.g. 5" required>
                    </div>
                    <div class="col-md-6">
                        <label for="mileage" class="form-label">Mileage (km)</label>
                        <input type="number" class="form-control" id="mileage" name="mileage" placeholder="e.g. 25000">
                    </div>
                    <div class="col-md-6">
                        <label for="fuelEfficiency" class="form-label">Fuel Efficiency (km/l)</label>
                        <input type="number" class="form-control" id="fuelEfficiency" name="fuelEfficiency" step="0.1"
                               placeholder="e.g. 15.5">
                    </div>
                </div>
            </div>
        </div>

        <!-- Rental Information Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-cash-coin"></i> Rental Information</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="dailyRate" class="form-label">Daily Rate ($) <span
                                class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="dailyRate" name="dailyRate" min="1"
                                   step="0.01" placeholder="49.99" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="weeklyRate" class="form-label">Weekly Rate ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="weeklyRate" name="weeklyRate" min="1"
                                   step="0.01" placeholder="299.99">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="monthlyRate" class="form-label">Monthly Rate ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="monthlyRate" name="monthlyRate" min="1"
                                   step="0.01" placeholder="999.99">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="minRentalDays" class="form-label">Minimum Rental Days <span
                                class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="minRentalDays" name="minRentalDays" min="1"
                               value="1" required>
                    </div>
                    <div class="col-md-6">
                        <label for="depositAmount" class="form-label">Key Money Deposit ($)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="depositAmount" name="depositAmount" min="0"
                                   step="0.01" placeholder="200.00">
                        </div>
                    </div>
                    <!-- <div class="col-12">
                         <label class="form-label">Availability</label>
                         <div class="input-group">
                             <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                             <input type="date" class="form-control" name="availableFrom" placeholder="From date">
                             <span class="input-group-text">to</span>
                             <input type="date" class="form-control" name="availableTo" placeholder="To date">
                         </div>
                     </div>-->
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="availableNow" name="availableNow">
                            <label class="form-check-label" for="availableNow">Available for immediate rental</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features & Amenities Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-list-check"></i> Features & Amenities</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="ac" name="features" value="AC">
                            <label class="form-check-label" for="ac"><i class="bi bi-snow"></i> Air Conditioning</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="bluetooth" name="features"
                                   value="Bluetooth">
                            <label class="form-check-label" for="bluetooth"><i class="bi bi-bluetooth"></i>
                                Bluetooth</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="navigation" name="features"
                                   value="Navigation">
                            <label class="form-check-label" for="navigation"><i class="bi bi-signpost"></i>
                                Navigation</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="sunroof" name="features"
                                   value="Sunroof">
                            <label class="form-check-label" for="sunroof"><i class="bi bi-sun"></i> Sunroof</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="cruiseControl" name="features"
                                   value="Cruise Control">
                            <label class="form-check-label" for="cruiseControl"><i class="bi bi-speedometer2"></i>
                                Cruise Control</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="backupCamera" name="features"
                                   value="Backup Camera">
                            <label class="form-check-label" for="backupCamera"><i class="bi bi-camera-video"></i> Backup
                                Camera</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="heatedSeats" name="features"
                                   value="Heated Seats">
                            <label class="form-check-label" for="heatedSeats"><i class="bi bi-thermometer-sun"></i>
                                Heated Seats</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="childSeat" name="features"
                                   value="Child Seat">
                            <label class="form-check-label" for="childSeat"><i class="bi bi-emoji-child"></i> Child Seat</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="tollPass" name="features"
                                   value="Toll Pass">
                            <label class="form-check-label" for="tollPass"><i class="bi bi-pass"></i> Toll Pass</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="gpsTracker" name="features"
                                   value="GPS Tracker">
                            <label class="form-check-label" for="gpsTracker"><i class="bi bi-pin-map"></i> GPS
                                Tracker</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="wifiHotspot" name="features"
                                   value="WiFi Hotspot">
                            <label class="form-check-label" for="wifiHotspot"><i class="bi bi-wifi"></i> WiFi
                                Hotspot</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Information Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title"><i class="bi bi-card-text"></i> Additional Information</h5>
                <div class="mb-3">
                    <label for="description" class="form-label">Vehicle Description <span
                            class="text-danger">*</span></label>
                    <textarea class="form-control" id="description" name="description" rows="4"
                              placeholder="Describe your vehicle, any special features, rental terms, etc."
                              required></textarea>
                </div>
                <div class="mb-3">
                    <label for="rentalTerms" class="form-label">Rental Terms & Conditions</label>
                    <textarea class="form-control" id="rentalTerms" name="rentalTerms" rows="3"
                              placeholder="Any specific terms for renters (e.g., smoking policy, mileage limits)"></textarea>
                </div>
            </div>
        </div>

        <!-- Verification Section -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="agreeTerms" name="agreeTerms" required>
                    <label class="form-check-label" for="agreeTerms">I certify that all information provided is accurate
                        and I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                </div>
            </div>
        </div>

        <!-- Form Submission -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="reset" class="btn btn-secondary me-md-2">
                <i class="bi bi-x-circle"></i> Reset Form
            </button>
            <button type="button" class="btn btn-primary" onclick="saveVehicle()">
                <i class="bi bi-check-circle"></i> Submit Vehicle Listing
            </button>
        </div>
    </form>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

<script>
    function saveVehicle() {
        const token = localStorage.getItem('token');
        const decodedToken = jwt_decode(token);
        const userEmail = decodedToken.email;

        const formData = new FormData();
        const image = $('#vehicleImages')[0].files[0];
        if (image) {
            formData.append('file', image);
        }

        const vehicleDTO = {
            vehicleType:     $('#vehicleType').val(),
            brand:           $('#brand').val(),
            model:           $('#model').val(),
            year:            parseInt($('#year').val()),
            plateNumber:     $('#plateNumber').val(),
            color:           $('#color').val(),

            fuelType:        $('#fuelType').val(),
            engineCapacity:  $('#engineCapacity').val() ? parseInt($('#engineCapacity').val()) : null,
            transmission:    $('#transmission').val(),
            seatingCapacity: parseInt($('#seatingCapacity').val()),
            mileage:         $('#mileage').val() ? parseInt($('#mileage').val()) : null,
            fuelEfficiency:  $('#fuelEfficiency').val() ? parseFloat($('#fuelEfficiency').val()) : null,

            dailyRate:       parseFloat($('#dailyRate').val()),
            weeklyRate:      $('#weeklyRate').val() ? parseFloat($('#weeklyRate').val()) : null,
            monthlyRate:     $('#monthlyRate').val() ? parseFloat($('#monthlyRate').val()) : null,
            minRentalDays:   parseInt($('#minRentalDays').val()),
            depositAmount:   $('#depositAmount').val() ? parseFloat($('#depositAmount').val()) : null,
            availableNow:    $('#availableNow').is(':checked'),

            airCondition:    $('#ac').is(':checked'),
            bluetooth:       $('#bluetooth').is(':checked'),
            Navigation:      $('#navigation').is(':checked'),
            sunroof:         $('#sunroof').is(':checked'),
            cruiseControl:   $('#cruiseControl').is(':checked'),
            backCamera:      $('#backupCamera').is(':checked'),
            heatedSeat:      $('#heatedSeats').is(':checked'),
            childSeat:       $('#childSeat').is(':checked'),
            tollPass:        $('#tollPass').is(':checked'),
            gpsTracker:      $('#gpsTracker').is(':checked'),
            wifiHotspot:     $('#wifiHotspot').is(':checked'),

            description:     $('#description').val(),
            rentalTerms:     $('#rentalTerms').val(),

            owner: {
                email:userEmail
            }
        };


        console.log('Vehicle DTO to be sent:', vehicleDTO);

        formData.append('vehicleDTO', new Blob([JSON.stringify(vehicleDTO)], {
            type: 'application/json'
        }));

        $.ajax({
            url: 'http://localhost:8080/api/v1/vehicle/saveVehicle',
            method: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: {
                Authorization: 'Bearer ' + token
            },
            success: function(response) {
                Swal.fire({
                    icon: 'success',
                    title: 'Vehicle saved successfully!',
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    window.location.href = 'postAddVehicle.html';
                });
            },
            error: function(xhr, status, error) {
                let errorMsg = error;
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMsg = xhr.responseJSON.message;
                }
                Swal.fire({
                    icon: 'error',
                    title: 'Error saving vehicle',
                    text: errorMsg,
                    showConfirmButton: true
                });
            }
        });
    }
    function handleImageUpload(input) {
        const previewContainer = document.getElementById('imagePreviewContainer');
        previewContainer.innerHTML = '';

        if (input.files && input.files.length > 0) {
            for (let i = 0; i < input.files.length; i++) {
                const file = input.files[i];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'image-preview-container';

                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';
                    img.alt = 'Vehicle preview';

                    const removeBtn = document.createElement('span');
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '&times;';
                    removeBtn.onclick = function () {
                        previewDiv.remove();
                    };

                    img.appendChild(removeBtn);
                    previewDiv.appendChild(img);
                    previewContainer.appendChild(previewDiv);
                }

                reader.readAsDataURL(file);
            }
        }
    }

    const dropzone = document.getElementById('imageDropzone');
    const fileInput = document.getElementById('vehicleImages');

    /*   dropzone.addEventListener('dragover', (e) => {
           e.preventDefault();
           dropzone.style.borderColor = '#0d6efd';
           dropzone.style.backgroundColor = '#f8f9fa';
       });

       dropzone.addEventListener('dragleave', () => {
           dropzone.style.borderColor = '#dee2e6';
           dropzone.style.backgroundColor = '';
       });

       dropzone.addEventListener('drop', (e) => {
           e.preventDefault();
           dropzone.style.borderColor = '#dee2e6';
           dropzone.style.backgroundColor = '';

           if (e.dataTransfer.files.length) {
               fileInput.files = e.dataTransfer.files;
               handleImageUpload(fileInput);
           }
       });

       document.getElementById('vehiclePostForm').addEventListener('submit', function(e) {
           e.preventDefault();
           // Here you would handle the form submission (AJAX or regular form submit)
           alert('Vehicle listing submitted successfully!');
           // Optionally reset the form
           this.reset();
           document.getElementById('imagePreviewContainer').innerHTML = '';
       });*/
</script>
</body>
</html>
